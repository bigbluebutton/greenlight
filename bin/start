#!/usr/bin/env bash

if [ -f .env ]; then
  export $(echo $(cat .env | sed 's/#.*//g'| xargs) | envsubst)
fi
export PORT="${PORT:=3000}"
echo "Web app starting on port: $PORT"

rails assets:precompile

if [ "$RAILS_ENV" = "production" ]; then
  while ! rails db:version 2>/dev/null
  do
    echo "Waiting for postgres to start up ..."
    sleep 1
  done
fi

rails db:create
rails db:migrate:with_data

rails s -b 0.0.0.0 -p $PORT
